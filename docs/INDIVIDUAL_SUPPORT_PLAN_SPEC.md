# å€‹åˆ¥æ”¯æ´è¨ˆç”» è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  æŠ€è¡“ä»•æ§˜æ›¸

**æœ€çµ‚æ›´æ–°**: 2026-01-19 23:45 JST
**å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: WatchMe Business API
**ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹**: Phase 0-4 ç¨¼åƒä¸­ âœ…
**å®Ÿè£…å®Œäº†åº¦**: 95% (Phase 0-4å®Œäº†ã€PDFç”Ÿæˆæœªå®Ÿè£…)

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [å‡¦ç†ãƒ•ãƒ­ãƒ¼](#å‡¦ç†ãƒ•ãƒ­ãƒ¼)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
4. [Phase 0: æ–‡å­—èµ·ã“ã—](#phase-0-æ–‡å­—èµ·ã“ã—)
5. [Phase 1: äº‹å®ŸæŠ½å‡º](#phase-1-äº‹å®ŸæŠ½å‡º)
6. [Phase 2: äº‹å®Ÿæ•´ç†](#phase-2-äº‹å®Ÿæ•´ç†)
7. [Phase 3: å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆ](#phase-3-å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆ)
8. [Phase 4: Excelå‡ºåŠ›](#phase-4-excelå‡ºåŠ›)
9. [UIå®Ÿè£…ï¼ˆç®¡ç†ç”»é¢è¡¨ç¤ºï¼‰](#uiå®Ÿè£…ç®¡ç†ç”»é¢è¡¨ç¤º)
10. [å…±é€šå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³](#å…±é€šå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³)
10. [LLMãƒ¢ãƒ‡ãƒ«ç®¡ç†](#llmãƒ¢ãƒ‡ãƒ«ç®¡ç†)
11. [ãƒ†ã‚¹ãƒˆæ–¹æ³•](#ãƒ†ã‚¹ãƒˆæ–¹æ³•)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ç›®çš„

ä¿è­·è€…ãƒ’ã‚¢ãƒªãƒ³ã‚°éŸ³å£°ã‹ã‚‰å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

### å‡¦ç†æ¦‚è¦

```
éŒ²éŸ³ï¼ˆwebmï¼‰
  â†’ æ–‡å­—èµ·ã“ã—ï¼ˆSpeechmaticsã€è©±è€…åˆ†é›¢ï¼‰
  â†’ äº‹å®ŸæŠ½å‡ºï¼ˆLLMã€11ã‚«ãƒ†ã‚´ãƒªï¼‰
  â†’ äº‹å®Ÿæ•´ç†ï¼ˆLLMã€æ”¯æ´è¨ˆç”»ç”¨ã«å†åˆ†é¡ï¼‰
  â†’ å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆï¼ˆLLMã€5é ˜åŸŸã®æ”¯æ´é …ç›®ï¼‰
  â†’ ç®¡ç†ç”»é¢è¡¨ç¤ºï¼ˆæ§‹é€ åŒ–UIï¼‰
  â†’ Excelå‡ºåŠ›ï¼ˆ2ã‚·ãƒ¼ãƒˆï¼‰
```

### å‡¦ç†æ™‚é–“

| ãƒ•ã‚§ãƒ¼ã‚º | å‡¦ç†æ™‚é–“ |
|---------|---------|
| Phase 0 | ç´„4.5åˆ†ï¼ˆ47åˆ†éŸ³å£°ã®å ´åˆï¼‰ |
| Phase 1 | 5-7ç§’ |
| Phase 2 | 6-7ç§’ |
| Phase 3 | 17ç§’ |
| Phase 4 | <1ç§’ï¼ˆExcelç”Ÿæˆï¼‰ |
| **åˆè¨ˆ** | **ç´„5åˆ†30ç§’** |

### è¨­è¨ˆæ€æƒ³

**3æ®µéšãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ**:

- **Phase 1-2**: äº‹å®Ÿã®ã¿ï¼ˆæ¨è«–ãƒ»è§£é‡ˆã‚¼ãƒ­ï¼‰â†’ è‡ªå‹•åŒ–å¯èƒ½
- **Phase 3**: å°‚é–€çš„åˆ¤æ–­ï¼ˆè§£é‡ˆãƒ»è©•ä¾¡ãƒ»å‰µé€ ï¼‰â†’ ç¾åœ¨ã¯è‡ªå‹•åŒ–ã€å°†æ¥çš„ã«Human in the Loopæƒ³å®š

---

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

### å…¨ä½“ãƒ•ãƒ­ãƒ¼

```
ã€Phase 0: æ–‡å­—èµ·ã“ã—ã€‘
éŒ²éŸ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (webm)
  â†“
S3ä¿å­˜ (s3://watchme-business/interviews/)
  â†“
Lambda: business-audio-upload-handler (S3ã‚¤ãƒ™ãƒ³ãƒˆ)
  â†“
Speechmatics Batch API (è©±è€…åˆ†é›¢å¯¾å¿œ)
  â†“
transcription ã‚«ãƒ©ãƒ ã«ä¿å­˜

ã€Phase 1: äº‹å®ŸæŠ½å‡ºã€‘
POST /api/analyze
  â†“
analyze_background() (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰)
  â†“
OpenAI GPT-4o (äº‹å®Ÿã®ã¿æŠ½å‡ºã€11ã‚«ãƒ†ã‚´ãƒª)
  â†“
fact_extraction_result_v1 (extraction_v1) ä¿å­˜

ã€Phase 2: äº‹å®Ÿæ•´ç†ã€‘
POST /api/structure-facts
  â†“
structure_facts_background()
  â†“
OpenAI GPT-4o (æ”¯æ´è¨ˆç”»ç”¨ã«å†åˆ†é¡)
  â†“
fact_structuring_result_v1 (fact_clusters_v1) ä¿å­˜

ã€Phase 3: å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆã€‘
POST /api/assess
  â†“
assess_background()
  â†“
OpenAI GPT-4o (å°‚é–€çš„åˆ¤æ–­ã€å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆ)
  â†“
assessment_result_v1 (assessment_v1) ä¿å­˜
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»

```
uploaded â†’ transcribing â†’ transcribed â†’ analyzing â†’ analyzed â†’ completed
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### business_interview_sessions ãƒ†ãƒ¼ãƒ–ãƒ«

**æœ€çµ‚ç¢ºèª**: 2026-01-18

```sql
-- åŸºæœ¬æƒ…å ±
id                           UUID PRIMARY KEY
facility_id                  UUID NOT NULL
subject_id                   UUID NOT NULL
support_plan_id              UUID
s3_audio_path                TEXT
staff_id                     UUID
session_type                 TEXT
session_number               INTEGER
attendees                    JSONB
duration_seconds             INTEGER

-- Phase 0: æ–‡å­—èµ·ã“ã—
transcription                TEXT
transcription_metadata       JSONB

-- Phase 1: äº‹å®ŸæŠ½å‡º
fact_extraction_prompt_v1    TEXT
fact_extraction_result_v1    JSONB

-- Phase 2: äº‹å®Ÿæ•´ç†
fact_structuring_prompt_v1   TEXT
fact_structuring_result_v1   JSONB

-- Phase 3: å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆ
assessment_prompt_v1         TEXT
assessment_result_v1         JSONB

-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
status                       TEXT DEFAULT 'recording'
error_message                TEXT

-- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
recorded_at                  TIMESTAMPTZ
created_at                   TIMESTAMPTZ DEFAULT now()
updated_at                   TIMESTAMPTZ DEFAULT now()
```

---

## Phase 0: æ–‡å­—èµ·ã“ã—

### æ¦‚è¦

- **å®Ÿè£…æ—¥**: 2026-01-13
- **çŠ¶æ…‹**: âœ… ç¨¼åƒä¸­
- **ASRãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**: Speechmatics Batch API
- **ç‰¹å¾´**: è©±è€…åˆ†é›¢å¯¾å¿œï¼ˆ3åä»¥ä¸Šæ¤œå‡ºå¯èƒ½ï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
éŒ²éŸ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ S3 â†’ Lambda â†’ Speechmatics â†’ DBä¿å­˜
```

### å‡¦ç†é€Ÿåº¦

- 30ç§’éŸ³å£°: ç´„26ç§’ï¼ˆã»ã¼ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
- 47åˆ†éŸ³å£°: ç´„4.5åˆ†ï¼ˆ**10.6å€é€Ÿ**ï¼‰

### å‡ºåŠ›

**transcription ã‚«ãƒ©ãƒ **:
```
Speaker 1: ã“ã‚“ã«ã¡ã¯ã€æœ¬æ—¥ã¯ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚
Speaker 2: ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚
...
```

---

## Phase 1: äº‹å®ŸæŠ½å‡º

### æ¦‚è¦

- **å®Ÿè£…æ—¥**: 2026-01-17
- **çŠ¶æ…‹**: âœ… ç¨¼åƒä¸­
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/analyze`
- **ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«**: OpenAI gpt-4o
- **å‡¦ç†æ™‚é–“**: 5-7ç§’

### è²¬å‹™

ãƒ’ã‚¢ãƒªãƒ³ã‚°æ–‡å­—èµ·ã“ã—ã‹ã‚‰**äº‹å®Ÿã®ã¿ã‚’æŠ½å‡º**ã™ã‚‹ã€‚

**DO**:
- ç™ºè¨€ã•ã‚ŒãŸå†…å®¹ã‚’11ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡
- äº‹å®Ÿã®è¦ç´„ï¼ˆsummaryï¼‰
- ä¿¡é ¼åº¦ï¼ˆconfidenceï¼‰ã®ä»˜ä¸

**DON'T**:
- æ¨è«–ãƒ»è§£é‡ˆï¼ˆã€Œã€œã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€ã€Œã€œã®å¯èƒ½æ€§ã€ï¼‰
- å› æœé–¢ä¿‚ã®ä»˜ä¸
- å°‚é–€çš„åˆ¤æ–­

### å‡ºåŠ›æ§‹é€ 

**fact_extraction_result_v1**:
```json
{
  "extraction_v1": {
    "basic_info": [
      {"field": "æ°å", "value": "æ¾æœ¬æ­£å¼¦", "confidence": "high"}
    ],
    "current_state": [...],
    "strengths": [...],
    "challenges": [...],
    "physical_sensory": [...],
    "medical_development": [...],
    "family_environment": [...],
    "parent_intentions": [
      {"summary": "æ¥½ã—ãéŠã³ãŸã„", "priority": 1, "confidence": "high"}
    ],
    "staff_notes": [...],
    "administrative_notes": [...],
    "unresolved_items": [...]
  }
}
```

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/app.py`: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
- `backend/services/background_tasks.py`: `analyze_background()`
- `backend/services/prompts.py`: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆPhase 1ã¯ç›´æ¥åŸ‹ã‚è¾¼ã¿ï¼‰

---

## Phase 2: äº‹å®Ÿæ•´ç†

### æ¦‚è¦

- **å®Ÿè£…æ—¥**: 2026-01-18
- **çŠ¶æ…‹**: âœ… ç¨¼åƒä¸­
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/structure-facts`
- **ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«**: OpenAI gpt-4o
- **å‡¦ç†æ™‚é–“**: 6-7ç§’

### è²¬å‹™

extraction_v1ã‚’**æ”¯æ´è¨ˆç”»ç”¨ã«å†åˆ†é¡**ã™ã‚‹ã€‚

**Phase 2ã®å½¹å‰²**:
> ã€Œåˆ¤æ–­ã‚’ã—ãªã„ä»£ã‚ã‚Šã«ã€åˆ¤æ–­ã—ã‚„ã™ã•ã‚’æœ€å¤§åŒ–ã™ã‚‹å·¥ç¨‹ã€

**DO**:
- Phase 1ã®11ã‚«ãƒ†ã‚´ãƒªã‚’æ”¯æ´è¨ˆç”»ç”¨ã®é ˜åŸŸã«å†é…ç½®
- æ–‡è„ˆçš„ã«è¿‘ã„äº‹å®Ÿã‚’æŸã­ã‚‹
- Phase 3ãŒå‚ç…§ã—ã‚„ã™ã„"åˆ¤æ–­ææ–™ã‚»ãƒƒãƒˆ"ã‚’ä½œã‚‹

**DON'T**:
- è§£é‡ˆãƒ»è©•ä¾¡ï¼ˆã€Œã€œãŒå¿…è¦ã€ã€Œã€œãŒèª²é¡Œã€ï¼‰
- å› æœé–¢ä¿‚ã®ä½œæˆ
- äº‹å®Ÿã®éåº¦ãªè¦ç´„ï¼ˆæƒ…å ±é‡ã‚’æ¸›ã‚‰ã•ãªã„ï¼‰

### å‡ºåŠ›æ§‹é€ 

**fact_structuring_result_v1**:
```json
{
  "fact_clusters_v1": {
    "child_profile": {
      "name": "string",
      "age": number,
      "diagnosis": ["string"],
      "school_name": "string"
    },
    "strengths_facts": [...],
    "challenges_facts": [...],
    "cognitive_facts": [...],
    "behavior_facts": [...],
    "social_communication_facts": [...],
    "physical_sensory_facts": [...],
    "daily_living_facts": [...],
    "medical_facts": [...],
    "family_context": [...],
    "parent_child_intentions": [
      {"speaker": "æœ¬äºº", "intention": "...", "priority": 1}
    ],
    "service_administrative_facts": [...]
  }
}
```

### ã‚­ãƒ¼è¨­è¨ˆã®æ„å›³

- `strengths_facts` / `challenges_facts` â†’ ç›®æ¨™è¨­å®šç”¨
- `cognitive_facts` / `behavior_facts` â†’ æ”¯æ´è¨ˆç”»ç”¨
- `parent_child_intentions` â†’ æœ¬äººãƒ»ä¿è­·è€…ã®å¸Œæœ›

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/app.py`: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
- `backend/services/background_tasks.py`: `structure_facts_background()` (ç´„30è¡Œ)
- `backend/services/prompts.py`: `build_fact_structuring_prompt()`
- `backend/services/llm_pipeline.py`: å…±é€šå‡¦ç†ï¼ˆ`execute_llm_phase()`ï¼‰

---

## Phase 3: å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆ

### æ¦‚è¦

- **å®Ÿè£…æ—¥**: 2026-01-18
- **çŠ¶æ…‹**: âœ… ç¨¼åƒä¸­
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/assess`
- **ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«**: OpenAI gpt-4o
- **å‡¦ç†æ™‚é–“**: 17ç§’

### è²¬å‹™

fact_clusters_v1ã‹ã‚‰**å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸**ã‚’ç”Ÿæˆã™ã‚‹ã€‚

**Phase 3ã§åˆã‚ã¦è¨±å¯ã•ã‚Œã‚‹ã“ã¨**:
- è§£é‡ˆãƒ»è©•ä¾¡ï¼ˆã€Œã€œã¨è¦‹ç«‹ã¦ã¦ã„ã¾ã™ã€ã€Œã€œãŒå¿…è¦ã§ã‚ã‚‹ã€ï¼‰
- å› æœé–¢ä¿‚ã®æ¨è«–
- å°‚é–€å®¶è¦–ç‚¹ã§ã®åˆ¤æ–­

### å‡ºåŠ›æ§‹é€ 

**assessment_result_v1**:
```json
{
  "assessment_v1": {
    "support_policy": {
      "child_understanding": "å­ã©ã‚‚ã®ç†è§£ãƒ»è¦‹ç«‹ã¦ï¼ˆ200-400æ–‡å­—ï¼‰",
      "key_approaches": [
        "è¦–è¦šçš„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ´»ç”¨",
        "äº‹å‰èª¬æ˜ã®å¾¹åº•"
      ],
      "collaboration_notes": "ä¿è‚²åœ’ã¨ã®æƒ…å ±å…±æœ‰ã€è¨ªå•é€£æº"
    },
    "family_child_intentions": {
      "child": "æ¥½ã—ãéŠã³ãŸã„ï¼ˆæœ¬äººï¼‰",
      "parents": "å ´é¢ã«åˆã£ãŸè¡Œå‹•ã‚’..."
    },
    "long_term_goal": {
      "goal": "è¦–è¦šçš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ‰‹æ›ã‹ã‚Šã«...",
      "timeline": "6ã‹æœˆå¾Œ",
      "rationale": "æœ¬äººã®è¦–è¦šå„ªä½ãªç‰¹æ€§ã‚’æ´»ã‹ã—..."
    },
    "short_term_goals": [
      {
        "goal": "è¦‹ãˆã‚‹åŒ–ã•ã‚ŒãŸæ‰‹é †ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’...",
        "timeline": "3ã‹æœˆå¾Œ"
      }
    ],
    "support_items": [
      {
        "category": "é‹å‹•ãƒ»æ„Ÿè¦š",
        "target": "ã€Œã©ã†ãã€ã¨è¨€ã‚ã‚Œã¦ã‹ã‚‰æ´»å‹•ã«...",
        "methods": [
          "æ´»å‹•å‰ã«å…¨ä½“ã‚’æŒ‡å·®ã—ã™ã‚‹ç­‰ã‚’è¡Œã„...",
          "æ‰‹ã®å¹³ã€è¶³ã®è£ã€ãŠå°»ç­‰ä½“ã‚’æ”¯ãˆãŸã‚Š..."
        ],
        "staff": "ä½œæ¥­ç™‚æ³•å£«ã€ä¿è‚²å£«",
        "timeline": "6ã‹æœˆå¾Œ",
        "notes": "å°‚é–€çš„æ”¯æ´å®Ÿæ–½åŠ ç®—ã«ã¤ã„ã¦ã¯ã€åˆ¥ç´™å‚ç…§",
        "priority": 2
      }
    ],
    "family_support": {
      "goal": "æ—¥å¸¸ç”Ÿæ´»ã«ãŠã„ã¦ã€æœ¬äººã®æ„æ€ã‚’...",
      "methods": [...],
      "timeline": "6ã‹æœˆå¾Œ",
      "notes": "å­è‚²ã¦ã‚µãƒãƒ¼ãƒˆåŠ ç®—ï¼šæœˆ1å›..."
    },
    "transition_support": {
      "goal": "æ—¥å¸¸çš„ãªé€£æºã«åŠ ãˆã€ç‰¹ã«è¡Œäº‹ç­‰ã®éš›ã«ã¯...",
      "methods": [...],
      "partner_organization": "ã€‡ã€‡ä¿è‚²åœ’",
      "timeline": "6ã‹æœˆå¾Œ",
      "notes": "ä¿è­·è€…ã®æ„å‘ã‚‚ç¢ºèªã—ãªãŒã‚‰..."
    }
  }
}
```

### 5é ˜åŸŸã‚«ãƒãƒ¬ãƒƒã‚¸

å…ç«¥ç™ºé”æ”¯æ´ã®5é ˜åŸŸã‚’å¿…ãšã‚«ãƒãƒ¼ï¼š

1. å¥åº·ãƒ»ç”Ÿæ´»
2. é‹å‹•ãƒ»æ„Ÿè¦š
3. èªçŸ¥ãƒ»è¡Œå‹•
4. è¨€èªãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
5. äººé–“é–¢ä¿‚ãƒ»ç¤¾ä¼šæ€§

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/app.py`: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
- `backend/services/background_tasks.py`: `assess_background()` (ç´„30è¡Œ)
- `backend/services/prompts.py`: `build_assessment_prompt()`
- `backend/services/llm_pipeline.py`: å…±é€šå‡¦ç†ï¼ˆ`execute_llm_phase()`ï¼‰

---

## Phase 4: Excelå‡ºåŠ›

### æ¦‚è¦

- **å®Ÿè£…æ—¥**: 2026-01-19
- **çŠ¶æ…‹**: âœ… ç¨¼åƒä¸­
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/sessions/{session_id}/download-excel`
- **ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: openpyxl
- **å‡¦ç†æ™‚é–“**: <1ç§’

### è²¬å‹™

assessment_v1ã‹ã‚‰**å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸ã®Excelãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆ2ã‚·ãƒ¼ãƒˆæ§‹æˆï¼‰ã€‚

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### Sheet 1: åˆ¥ç´™1-1ï¼ˆå€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸ï¼‰
- ã‚¿ã‚¤ãƒˆãƒ«ï¼šå€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸
- åˆ©ç”¨å…æ°åãƒ»å¹´é½¢ï¼ˆsubjectsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ï¼‰
- ç·åˆçš„ãªæ”¯æ´æ–¹é‡
- é•·æœŸç›®æ¨™ãƒ»çŸ­æœŸç›®æ¨™
- æ”¯æ´é …ç›®ï¼ˆ5é ˜åŸŸï¼‰
  - é‹å‹•ãƒ»æ„Ÿè¦š
  - è¨€èªãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  - å¥åº·ãƒ»ç”Ÿæ´»
  - èªçŸ¥ãƒ»è¡Œå‹•
  - äººé–“é–¢ä¿‚ãƒ»ç¤¾ä¼šæ€§
- å®¶æ—æ”¯æ´
- ç§»è¡Œæ”¯æ´ãƒ»åœ°åŸŸé€£æº

#### Sheet 2: åˆ¥ç´™1-2ï¼ˆå€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸åˆ¥è¡¨ï¼‰
- é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæœˆã€œæ—¥ãƒ»ç¥æ—¥ï¼‰
- æä¾›æ™‚é–“ï¼ˆåˆ©ç”¨é–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ï¼‰
- å»¶é•·æ”¯æ´æ™‚é–“
  - ã€æ”¯æ´å‰ã€‘å»¶é•·æ”¯æ´æ™‚é–“
  - ã€æ”¯æ´å¾Œã€‘å»¶é•·æ”¯æ´æ™‚é–“
- å»¶é•·ã‚’å¿…è¦ã¨ã™ã‚‹ç†ç”±
- ç‰¹è¨˜äº‹é …

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/services/excel_generator.py`: Excelç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
  - `generate_support_plan_excel()`: ãƒ¡ã‚¤ãƒ³é–¢æ•°
  - `generate_main_support_plan()`: Sheet 1ç”Ÿæˆ
  - `generate_support_schedule()`: Sheet 2ç”Ÿæˆ
  - `extract_assessment_v1()`: ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºï¼ˆãƒ©ãƒƒãƒ—ã•ã‚ŒãŸJSONå¯¾å¿œï¼‰
- `backend/app.py`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `frontend/src/components/Phase3Display.tsx`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³UI

### APIä»•æ§˜

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/sessions/{session_id}/download-excel`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
- Content-Type: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
- ãƒ•ã‚¡ã‚¤ãƒ«å: `å€‹åˆ¥æ”¯æ´è¨ˆç”»_{session_id}.xlsx`

### ãƒ‡ãƒ¼ã‚¿å–å¾—å„ªå…ˆé †ä½

1. **subjectsãƒ†ãƒ¼ãƒ–ãƒ«**ï¼ˆå…ç«¥åãƒ»å¹´é½¢ï¼‰
2. **assessment_v1.child_profile**ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ï¼ˆã€‡ã€‡ ã€‡ã€‡ã€5æ­³ï¼‰

---

## UIå®Ÿè£…ï¼ˆç®¡ç†ç”»é¢è¡¨ç¤ºï¼‰

### æ¦‚è¦

- **å®Ÿè£…æ—¥**: 2026-01-19
- **çŠ¶æ…‹**: âœ… ç¨¼åƒä¸­
- **ãƒšãƒ¼ã‚¸**: å€‹åˆ¥æ”¯æ´è¨ˆç”»è©³ç´°ç”»é¢ï¼ˆSession Detail Drawerï¼‰

### å®Ÿè£…ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### Phase1Display.tsx
- 11ã‚«ãƒ†ã‚´ãƒªã®äº‹å®ŸæŠ½å‡ºçµæœã‚’æ§‹é€ åŒ–è¡¨ç¤º
- ä¿¡é ¼åº¦ãƒãƒƒã‚¸ï¼ˆhigh/medium/lowï¼‰
- å„ªå…ˆåº¦è¡¨ç¤º

#### Phase2Display.tsx
- 11ã‚«ãƒ†ã‚´ãƒªã®äº‹å®Ÿæ•´ç†çµæœã‚’æ§‹é€ åŒ–è¡¨ç¤º
- å…ç«¥ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
- ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆå¼·ã¿=ç·‘ã€èª²é¡Œ=é»„è‰²ï¼‰
- æœ¬äººãƒ»ä¿è­·è€…ã®æ„å‘ï¼ˆè©±è€…åˆ¥ï¼‰

#### Phase3Display.tsx
- å€‹åˆ¥æ”¯æ´è¨ˆç”»ã®å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
- æ”¯æ´æ–¹é‡ï¼ˆå­ã©ã‚‚ã®ç†è§£ãƒ»è¦‹ç«‹ã¦ã€ä¸»è¦ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€é€£æºäº‹é …ï¼‰
- é•·æœŸç›®æ¨™ãƒ»çŸ­æœŸç›®æ¨™
- æ”¯æ´é …ç›®ï¼ˆ5é ˜åŸŸï¼‰
- å®¶æ—æ”¯æ´
- ç§»è¡Œæ”¯æ´ãƒ»åœ°åŸŸé€£æº
- **Excelãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³**

### ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºå‡¦ç†

å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§`{"summary": "```json\n{...}\n```"}`å½¢å¼ã®ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸJSONã«å¯¾å¿œï¼š

```typescript
// Handle wrapped JSON format
if (!extraction && (data as any).summary) {
  const jsonMatch = summaryText.match(/```json\s*\n([\s\S]*?)\n```/);
  if (jsonMatch) {
    const parsed = JSON.parse(jsonMatch[1]);
    extraction = parsed.extraction_v1;
  }
}
```

---

## å…±é€šå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### è¨­è¨ˆåŸå‰‡

**DRYåŸå‰‡ã«åŸºã¥ãçµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼ˆ2026-01-18ç­–å®šï¼‰

ã™ã¹ã¦ã®ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆPhase 1-3ï¼‰ã¯ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ï¼š

1. **å…±é€šLLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**ã‚’ä½¿ç”¨ï¼ˆ`llm_pipeline.py`ï¼‰
2. **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é–¢æ•°ã¯ç´„30è¡Œ**ï¼ˆ`execute_llm_phase()`ã‚’å‘¼ã¶ã ã‘ï¼‰
3. **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼ˆæ¤œè¨¼ â†’ ã‚¹ãƒ¬ãƒƒãƒ‰èµ·å‹• â†’ 202è¿”å´ï¼‰

### å…±é€šå‡¦ç†ãƒ•ãƒ­ãƒ¼

```python
# backend/services/llm_pipeline.py
def execute_llm_phase(
    session_id,
    supabase,
    llm_service,
    phase_name,
    prompt_builder,
    input_selector,
    output_column,
    prompt_column
):
    """
    çµ±ä¸€LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

    1. DB.select() - å‰ãƒ•ã‚§ãƒ¼ã‚ºçµæœå–å¾—
    2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
    3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆDBä¿å­˜
    4. LLMå‘¼ã³å‡ºã—
    5. JSON parseï¼ˆæŸ”è»Ÿå¯¾å¿œï¼‰
    6. çµæœDBä¿å­˜
    """
```

### ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é–¢æ•°ã®å®Ÿè£…ä¾‹

```python
def structure_facts_background(session_id, supabase, llm_service):
    """Phase 2: äº‹å®Ÿæ•´ç†"""
    execute_llm_phase(
        session_id=session_id,
        supabase=supabase,
        llm_service=llm_service,
        phase_name="fact_structuring",
        prompt_builder=build_fact_structuring_prompt,
        input_selector="fact_extraction_result_v1",
        output_column="fact_structuring_result_v1",
        prompt_column="fact_structuring_prompt_v1"
    )
```

**å®Ÿè£…è¡Œæ•°**: ç´„30è¡Œï¼ˆPhase 1, 2, 3ã™ã¹ã¦ï¼‰

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
@app.post("/api/{phase}")
async def {phase}(request, x_api_token):
    # 1. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    # 2. å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆå‰ãƒ•ã‚§ãƒ¼ã‚ºçµæœå­˜åœ¨ï¼‰
    # 3. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰èµ·å‹•
    # 4. å³åº§ã«202 Acceptedè¿”å´
```

---

## LLMãƒ¢ãƒ‡ãƒ«ç®¡ç†

### ç¾åœ¨ã®è¨­å®š

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/services/llm_providers.py`

```python
CURRENT_PROVIDER = "openai"
CURRENT_MODEL = "gpt-4o"
```

### ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«

| ãƒ•ã‚§ãƒ¼ã‚º | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | é–¢æ•°å | ãƒ¢ãƒ‡ãƒ« | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ |
|---------|--------------|--------|--------|------------|
| Phase 1 | POST /api/analyze | `analyze_background()` | gpt-4o | OpenAI |
| Phase 2 | POST /api/structure-facts | `structure_facts_background()` | gpt-4o | OpenAI |
| Phase 3 | POST /api/assess | `assess_background()` | gpt-4o | OpenAI |

### ã‚³ã‚¹ãƒˆè©¦ç®—ï¼ˆ1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚ãŸã‚Šï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³ | å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³ | ã‚³ã‚¹ãƒˆ |
|---------|------------|------------|--------|
| Phase 1 | 15,000 | 2,000 | $0.10 |
| Phase 2 | 2,500 | 1,500 | $0.03 |
| Phase 3 | 2,000 | 3,000 | $0.05 |
| **åˆè¨ˆ** | **19,500** | **6,500** | **$0.18** |

### ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆæ–¹æ³•

1. `llm_providers.py`ã®å®šæ•°ã‚’å¤‰æ›´
2. ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥
3. GitHub Actionsè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆç´„7åˆ†ï¼‰

---

## ãƒ†ã‚¹ãƒˆæ–¹æ³•

### æ¨™æº–ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

**session_id**: `a522ab30-77ca-4599-81b8-48bc8deca835`

- å¯¾è±¡: æ¾æœ¬æ­£å¼¦ï¼ˆ5æ­³ã€ASDã€å¢ƒç•ŒçŸ¥èƒ½ IQ81ã€ç™½å¹¡å¹¼ç¨šåœ’ï¼‰
- æ–‡å­—èµ·ã“ã—: 15,255èª
- å‚åŠ è€…: çˆ¶ãƒ»æ¯
- éŒ²éŸ³æ—¥: 2026-01-13

### ãƒ•ãƒ«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ

```bash
# Phase 1: äº‹å®ŸæŠ½å‡º
curl -X POST https://api.hey-watch.me/business/api/analyze \
  -H "X-API-Token: watchme-b2b-poc-2025" \
  -H "Content-Type: application/json" \
  -d '{"session_id": "a522ab30-77ca-4599-81b8-48bc8deca835"}'

# Phase 2: äº‹å®Ÿæ•´ç†
curl -X POST https://api.hey-watch.me/business/api/structure-facts \
  -H "X-API-Token: watchme-b2b-poc-2025" \
  -H "Content-Type: application/json" \
  -d '{"session_id": "a522ab30-77ca-4599-81b8-48bc8deca835"}'

# Phase 3: å€‹åˆ¥æ”¯æ´è¨ˆç”»ç”Ÿæˆ
curl -X POST https://api.hey-watch.me/business/api/assess \
  -H "X-API-Token: watchme-b2b-poc-2025" \
  -H "Content-Type: application/json" \
  -d '{"session_id": "a522ab30-77ca-4599-81b8-48bc8deca835"}'
```

### çµæœç¢ºèªï¼ˆSupabase SQL Editorï¼‰

```sql
SELECT
    fact_extraction_result_v1 IS NOT NULL as has_phase1,
    fact_structuring_result_v1 IS NOT NULL as has_phase2,
    assessment_result_v1 IS NOT NULL as has_phase3,
    updated_at
FROM business_interview_sessions
WHERE id = 'a522ab30-77ca-4599-81b8-48bc8deca835';
```

---

## å‚è€ƒè³‡æ–™

- ãƒªã‚¿ãƒªã‚³å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸æ§˜å¼: `/Users/kaya.matsumoto/projects/watchme/docs/å€‹åˆ¥æ”¯æ´è¨ˆç”»/å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸ï¼ˆå‚è€ƒè¨˜è¼‰ä¾‹ï¼‰ãƒªã‚¿ãƒªã‚³.pdf`
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: `/Users/kaya.matsumoto/Desktop/business_interview_sessions_rows.csv`

---

## æ”¹è¨‚å±¥æ­´

- 2026-01-18 23:30: é–‹ç™ºè¨ˆç”»æ›¸ã‹ã‚‰æŠ€è¡“ä»•æ§˜æ›¸ã«å…¨é¢æ”¹è¨‚ï¼ˆPhase 0-3å®Œäº†æ™‚ç‚¹ï¼‰
- 2026-01-18 19:00: Phase 2ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„ã€DRYåŸå‰‡è¿½åŠ 
- 2026-01-18 åˆç‰ˆ: Phase 1å®Œäº†ã€Phase 2å®Ÿè£…ä¸­
